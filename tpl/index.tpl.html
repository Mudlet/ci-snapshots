<!DOCTYPE HTML>
<html lang="{PG_LANG}">
<head>
<meta charset="utf-8">
<meta name="robots" content="noindex, nofollow" />

<link rel="shortcut icon" href="{SITE_URL}favicon.ico">

<link rel="stylesheet" href="{SITE_URL}tpl/css/fa5.8.2-all.min.css">

<style>
body,td,th {
  font-family: "Open Sans", Arial, Helvetica, sans-serif;
  font-size: 1em;
  color: #000;
}
body {
  background-color: #222;
  margin-left: 0px;
  margin-top: 0px;
  margin-right: 0px;
  margin-bottom: 0px;
}
img {
  vertical-align: bottom;
}

a, a:link {
  color: #a54b03;
}
a:visited {
  color: #9a5c34;
}
a:hover, a:active {
  color: #dc4c00;
}

header {
  background: url('{SITE_URL}tpl/img/mudlet-header-bgtile.png');
  border-bottom: 1px solid #eae1bb;
  max-height: 80px;
}
header .logo-link {
  display: inline-block;
  margin-left: 16px;
}
header nav {
  float: right;
  margin-top: 16px;
}
header nav a {
  display: inline-block;
  font-weight: bold;
  text-decoration: none;
  font-size: 1em;
  margin-right: 12px;
  padding-top: 16px;
  padding-bottom: 16px;
  padding-left: 4px;
  padding-right: 4px;
}

section.bg-white {
  background-color: #FFF;
  display: inline-block;
  width: 100%;
}
section.bg-white h1 {
  font-size: 1.5em;
}
section.bg-white h2 {
  font-size: 1.15em;
}
section.bg-white h1,
section.bg-white h2 {
  margin-left: 12px;
}
section.bg-white.compact {
  text-align: center;
}
section.bg-white.compact h1,
section.bg-white.compact h2 {
  margin-left: 0px;
}
section.bg-white p {
  margin-left: 1.1em;
  line-height: 1.4em;
}

footer {
  color: #efefef;
  padding: 12px;
  font-size: 0.8em;
}

footer a {
  text-decoration: none;
  margin-top: 1.2em;
  margin-right: 1.5em;
  display: inline-block;
}


.filelist {
  display: inline-flex;
  flex-direction: column;
  list-style-type: none;
  list-style-position: initial;
  list-style-image: initial;
  padding: 0px;
  width: 100%;
}
.compact .filelist {
  width: auto;
}
.filelist-item {
  flex: 1;
  padding: 5px;
  padding-left: 12px;
  padding-right: 12px;
  text-align: left;
}
.filelist-item:nth-child(even) {
  background: #efefef;
}
.fileinfo {
  float: right;
}
.filesize {
  width: 70px;
  display: inline-block;
  text-align: center;
}
.filedls {
  width: 70px;
  display: inline-block;
  text-align: center;
}
.filetime {
  width: 170px;
  display: inline-block;
  text-align: center;
  word-spacing: 5px;
}
.filegitlinks {
  width: 70px;
  display: inline-block;
  text-align: right;
}
.filegitlinks a {
  margin-right: 12px;
}
.filegitlinks a:last-child {
  margin-right: 0px;
}

.platform-icon {
    font-size: 1.3em;
    vertical-align: middle;
    padding-right: 0.4em;
}

.hinfo {
  text-align: center;
  font-weight: bold;
  font-size: 1.1em;
  list-style-type: none;
  list-style-position: initial;
  list-style-image: initial;
  padding-bottom: 6px;
  margin-bottom: 10px;
  border-bottom: 1px solid rgb(170,170,170);
}
.hinfo .filetime {
  text-align: center;
}
.hinfo .filegitlinks {
  text-align: center;
}

.filter-ctrl {
    margin-left: 1.4em;
    margin-top: 2em;
}

.masterlist {
  display: none;
  visibility: hidden;
}

.latest-branch-files span {
  margin-top: 3px;
  margin-bottom: 3px;
  display: inline-block;
}
.latest-branch-files label {
  width: 100px;
  text-align: right;
  margin-right: 6px;
  display: inline-block;
}

@media (prefers-color-scheme: dark) {
  body {
    filter: invert(1) hue-rotate(.5turn);
  }
  footer {
    color: #000;
  }
}

</style>

<title>{L_TITLE}</title>

</head>
<body>
<header>
  <a class="logo-link" href="{SITE_URL}"><img src="{SITE_URL}tpl/img/mudlet-wp-logo.png" alt="{L_LOGO_ALT}" title="{L_LOGO_ALT}" /></a>
  <nav>
    {L_NAV_LINK_HOME}
    {L_NAV_LINK_WIKI}
    {L_NAV_LINK_FORUM}
  </nav>
</header>
<section class="bg-white">
  <h1>{L_DESC_HEADING}</h1>
  <p>{L_DESC_TEXT}<br />
  {L_TIME_SHOWN_IN}<span class="pg-timezone">{PG_TIMEZONE}</span></p>
  
  <div class="latest-branch-files">
    <h2>{L_LATEST_HEADING}</h2>
    <p>{LATEST_BRANCH_SNAPSHOTS}</p>
  </div>
  
  <div class="filter-ctrl">
    {L_FILTER_PLATFORM_TEXT}
    <select name="platform_filter" id="platform_filter">
      <option value="all">{L_FILTER_ALL_PLATFORMS}</option>
      <option value="windows">Windows</option>
      <option value="linux">Linux</option>
      <option value="macos">Mac OS</option>
    </select>
    {L_FILTER_SOURCE_TEXT}
    <select name="source_filter" id="source_filter">
      <option value="all">{L_FILTER_SOURCE_BPR}</option>
      <option value="branch">{L_FILTER_SOURCE_BRO}</option>
      <option value="pull-request">{L_FILTER_SOURCE_PRO}</option>
      {BRANCH_NAMES_OPTS}
    </select>
    {L_REMEMBER_VIA_COOKIE}<input type="checkbox" name="filter_cookie" id="filter_cookie" value="1">
  </div>
  {SNAPSHOT_LIST}
</section>
<footer>
  {L_FOOTER_TIME_SHOWN_IN} <span class="pg-timezone">{PG_TIMEZONE}</span> - {PG_SIZE_LISTED} {L_FOOTER_STORAGE_USED} - 
  {L_FOOTER_TAGLINE}
  <br />
  {L_FOOTER_LINKS}
</footer>

<script src="{SITE_URL}tpl/js/js.cookie.js"></script>
<script src="{SITE_URL}tpl/js/jquery-3.4.1.slim.min.js"></script>
<script>
  var hasClonedList = false;
  
  function getQueryParams() {
    var currentURL = window.location.search.substring(1);
    var currentParams = currentURL.split('&');
    var params = [];
    for (var i = 0; i < currentParams.length; i++) {
      var paramData = currentParams[i].split('=');
      params.push(paramData[0]);
      params[paramData[0]] = paramData[1];
    }
    return params;
  }
  function getQueryParam(name)  {
    var params = getQueryParams();
    if ( name in params ) {
      return params[name];
    } else {
      return undefined;
    }
  }
  
  function setPageUrlParams(params) {
    if (window.history.pushState) {
      pageUrl = window.location.pathname;
      pageUrl += '?' + $.param(params);
      
      window.history.pushState({}, null, pageUrl);
      return true;
    }
    return false;
  }
  
  function setFilterCookie(cookieName, platVal, srcVal) {
    var CookieOpts = {expires: 365};
    var CookieValue = {platform: platVal, source: srcVal};
    Cookies.set(cookieName, CookieValue, CookieOpts);
  }
  
  function padZero(i) {
    if (i < 10) {
        i = "0" + i;
    }
    return i;
  }
  
  function showListItems(platform, source) {
    if ( hasClonedList == false ) {
      // Clone original list, with local conversions, for use in filtering.
      var $masterList = $('<ul class="masterlist"></ul>');
      var $clonedList = $('.filelist-item').clone();
      $clonedList.appendTo($masterList);
      $masterList.appendTo('section.bg-white');
      hasClonedList = true;
    }
  
    $('ul.filelist .filelist-item').remove();
    if (platform == 'all') {
      if (source == 'all') {
        $('ul.masterlist .filelist-item').clone().appendTo('ul.filelist');
      } else {
        $('ul.masterlist .filelist-item.'+ source).clone().appendTo('ul.filelist');
      }
    } else {
      if (source == 'all') {
        $('ul.masterlist .filelist-item.'+ platform ).clone().appendTo('ul.filelist');
      } else {
        $('ul.masterlist .filelist-item.'+ platform + '.'+ source ).clone().appendTo('ul.filelist');
      }
    }
    
    setPageUrlParams({'platform':platform, 'source':source});
  }
  
  $(document).ready(function(){
    var pg_timezone = $.trim($('span.pg-timezone:first').text());
    var sys_timezone = '';
    var defaultSources = ['all', 'branch', 'pull-request'];
    var filterCookieName  = 'snapshots_show_only';
    var filterCookieValue = Cookies.getJSON(filterCookieName);
    
    $('.filelist-item .filetime').each(function(idx){
      var timeStr = $(this).data('isotime');
      var dateObj = new Date(timeStr);
      var opts = {
        hour12: false,
        day:    '2-digit',
        month:  '2-digit',
        year:   'numeric',
        hour:   '2-digit',
        minute: '2-digit'
      };
      var localFormattedTime = dateObj.toLocaleDateString('default', opts);
      localFormattedTime = localFormattedTime.replace(',', '');
      localFormattedTime = localFormattedTime.replace(new RegExp('/', 'g'), '-');
      $(this).text(localFormattedTime);
      
      if( sys_timezone == '' ) {
        var topts = {
          timeZoneName: 'short'
        }
        var tmpDateStr = dateObj.toLocaleDateString('default', topts).split(" ");
        sys_timezone = tmpDateStr[ (tmpDateStr.length - 1) ];
      }
    });
    
    $('span.pg-timezone').html( "{L_JS_LOCAL_TIME} <em>(" + sys_timezone + ")</em> <!-- server tz: " + pg_timezone + " -->");
    
    $('#platform_filter').on('change', function() {
      var source_filter_val = $('#source_filter').val();
    
      showListItems( this.value, source_filter_val );
      if ( typeof filterCookieValue !== 'undefined' ) {
        if ( $('#filter_cookie').is(':checked') ) {
          setFilterCookie(filterCookieName, this.value, source_filter_val);
        }
      }
    });
    
    $('#source_filter').on('change', function() {
      var platform_filter_val = $('#platform_filter').val();
      
      showListItems( platform_filter_val, this.value );
      if ( typeof filterCookieValue !== 'undefined' ) {
        if ( $('#filter_cookie').is(':checked') ) {
          setFilterCookie(filterCookieName, platform_filter_val, this.value);
        }
      }
      
      //if ( defaultSources.indexOf(this.value) == -1 ) {
        // force reload to rebuild Latest List, as this is done server side.
      //  window.location.reload(true); 
      //}
    });
    
    $('#filter_cookie').on('change', function() {
      if ( $(this).is(':checked') ) {
        var platform_filter_val = $('#platform_filter').val();
        var source_filter_val = $('#source_filter').val();
        
        setFilterCookie(filterCookieName, platform_filter_val, source_filter_val);
      } else {
        Cookies.remove(filterCookieName);
      }
    });
    
    if ( typeof filterCookieValue !== 'undefined' ) {
      $('#filter_cookie').prop('checked', true);
      $('#platform_filter').val(filterCookieValue.platform);
      $('#source_filter').val(filterCookieValue.source);
      
      setTimeout('showListItems("'+ filterCookieValue.platform +'", "'+ filterCookieValue.source +'")', 250);
    }
    
    if ( getQueryParams().length > 0 ) {
      var urlFilterPlatform = getQueryParam('platform');
      var urlFilterSource = getQueryParam('source');
      if ( typeof urlFilterPlatform !== 'undefined' || typeof urlFilterSource !== 'undefined' ) 
      {
        var validPlatforms = ['windows','linux','macos'];
        var validSources =  {BRANCH_NAMES_JS}; 
        if (validPlatforms.indexOf(urlFilterPlatform) == -1) {
          urlFilterPlatform = 'all';
        }
        if (validSources.indexOf(urlFilterSource) == -1) {
          urlFilterSource = 'all';
        }
        
        $('#platform_filter').val(urlFilterPlatform);
        $('#source_filter').val(urlFilterSource);
        
        setTimeout('showListItems("'+ urlFilterPlatform +'", "'+ urlFilterSource +'")', 250);
      }
    }
    
    
  });
</script>

<!-- Matomo -->
<script type="text/javascript">
  var _paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
  _paq.push(["setCookieDomain", "*.mudlet.org"]);
  _paq.push(["setDomains", ["*.mudlet.org","*.forums.mudlet.org","*.make.mudlet.org","*.wiki.mudlet.org","*.forums.mudlet.org","*.make.mudlet.org","*.mudlet.org","*.wiki.mudlet.org"]]);
  _paq.push(["enableCrossDomainLinking"]);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://stats.mudlet.org/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Matomo Code -->

</body>
</html>